- name: Print all available facts
  ansible.builtin.debug:
    var: ansible_facts
- name: "Install default shell, tmux configs"
  # By default, only configure my personal stuff if I'm cceckman on the remote
  # end.
  when: "(ansible_facts['user_id'] == 'cceckman') or (force_config_defaults is defined)"
  include_tasks: dropin.yaml
- name: "Install default packages"
  # TODO: Apply only if we have sudo permissions on the target.
  become: true
  ansible.builtin.apt:
    update_cache: true
    pkg:
      - bash
      - dnsutils
      - git
      - htop
      - locales
      - mtr
      - net-tools
      - psmisc
      - python3
      - ripgrep
      - rsync
      - ssh
      - tcpdump
      - traceroute
      - vim
      - whois
      - zip
      - unzip
- name: "Customize shell"
  include_tasks: shell-config.yaml
  when: "(ansible_facts['user_id'] == 'cceckman') or (force_shell_setup is defined)"
- name: "Capture home directory"
  ansible.builtin.shell: "getent passwd | grep '^{{ ansible_facts['user_id'] | quote }}' | cut -d: -f6"
  register: find_homedir
- name: "Find existing Tilde checkout"
  ansible.builtin.stat:
    path: "{{ find_homedir.stdout_lines[0] | quote }}/r/github.com/cceckman/Tilde"
  register: tilde_checkout
- name: "Link home directory to tilde"
  include_tasks: home-config.yaml
  when: "(ansible_facts['user_id'] == 'cceckman') and ((full_home is defined) or (tilde_checkout.stat.exists))"


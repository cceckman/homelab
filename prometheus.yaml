---
- name: "Install Prometheus node_exporter"
  # Requires host facts
  hosts:
    - storage
    - rack18
    - rack19
  roles:
    - prometheus.prometheus.node_exporter
- name: "Configure prometheus servers"
  hosts: storage
  vars:
    prometheus_agent_mode: true
    prometheus_static_targets_files: "prometheus/{{ ansible_facts.hostname }}/*.yaml"
    prometheus_remote_write:
      - basic_auth:
          username: rack19-storage
          password: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            33646164643761393963393565613066636566356162653637346135623363363231666330633666
            3133663231333061343662663139653765636265356235630a626333306637336536333030613430
            65616635613138306362383966623266613436323063653065626264313839623163343934363766
            3839396363366136380a343234323032656136666530373364343432666135653363663762663831
            66626636313636316236653065336131323861666365303964376135643262396365353563383238
            66373832363563356437626439623730626333306337636261303531313863666463396664633964
            65656366383734306561396665366466616563333636656637663765623437313464633561356430
            34346463373139396231306665636661343136393363346336623738333637376437623065363266
            31363936626235306634353363326132343363323030666364303138366338633866
  roles:
    - prometheus.prometheus.prometheus


---
- name: "Bootstrap the homelab repository"
  hosts: "localhost"
  tasks:
  - name: "install git and refresh apt cache"
    become: yes
    ansible.builtin.apt:
      update_cache: yes
      pkg:
        - git
  - name: "Create directory for homelab snapshot"
    ansible.builtin.tempfile:
      state: "directory"
      suffix: "homelab.git"
    register: "homelab"
  - name: "Download homelab"
    ansible.builtin.git:
      repo: "https://github.com/cceckman/homelab.git"
      version: ansible
      dest: "{{ homelab.path }}"
      depth: 1
      single_branch: true
      update: true
      force: true
      clone: true
  - include_role:
      role: "{{ homelab.path }}/roles/autoconfigure"

